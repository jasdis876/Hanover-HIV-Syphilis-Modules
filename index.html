<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>STI SmartLearn ‚Äì Adult Education Portal</title>

  <style>
    /* CSS Reset & Base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    :root {
      --primary-blue: #2a6ebb;
      --primary-teal: #2bb5b5;
      --primary-green: #2bb57c;
      --primary-yellow: #ffcc4d;
      --primary-red: #e74c3c;
      --primary-purple: #9b59b6;
      --light-bg: #f8fafc;
      --card-bg: #ffffff;
      --text-dark: #2c3e50;
      --text-light: #5d6d7e;
      --shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      --radius: 16px;
      --transition: all 0.3s ease;
    }

    body {
      background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      color: var(--text-dark);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      min-height: calc(100vh - 100px);
    }

    /* Header */
    .header {
      text-align: center;
      padding: 25px 20px;
      margin-bottom: 30px;
      background: linear-gradient(to right, var(--primary-blue), var(--primary-teal));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      color: white;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 30px 30px;
      animation: float 20s linear infinite;
      opacity: 0.3;

      /* ‚úÖ IMPORTANT FIX: don't block clicks */
      pointer-events: none;
      z-index: 0;
    }

    /* ‚úÖ Ensure header content is above overlay */
    .header * {
      position: relative;
      z-index: 1;
    }

    @keyframes float {
      0% { transform: translate(0, 0) rotate(0deg); }
      100% { transform: translate(-30px, -30px) rotate(360deg); }
    }

    .header h1 {
      font-size: 2.8rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .header h2 {
      font-size: 1.3rem;
      font-weight: 400;
      opacity: 0.95;
      max-width: 700px;
      margin: 0 auto;
    }

    /* Main Content */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    /* Buttons */
    .btn {
      padding: 18px 30px;
      border: none;
      border-radius: var(--radius);
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-primary {
      background: linear-gradient(to right, var(--primary-blue), var(--primary-teal));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(42, 110, 187, 0.3);
    }

    .btn-secondary {
      background: linear-gradient(to right, var(--primary-green), #2bb59c);
      color: white;
    }

    .btn-secondary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(43, 181, 124, 0.3);
    }

    .btn-certificate {
      background: linear-gradient(to right, var(--primary-purple), #8e44ad);
      color: white;
      font-size: 1.3rem;
      padding: 20px 35px;
      margin: 20px auto;
      width: fit-content;
    }

    .btn-certificate.unlocked { animation: pulse 2s infinite; }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(155, 89, 182, 0.7); }
      70% { box-shadow: 0 0 0 15px rgba(155, 89, 182, 0); }
      100% { box-shadow: 0 0 0 0 rgba(155, 89, 182, 0); }
    }

    .btn-back {
      background: var(--text-light);
      color: white;
      padding: 12px 25px;
      font-size: 1rem;
    }

    /* Home Screen */
    .track-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .track-btn {
      height: 200px;
      flex-direction: column;
      font-size: 1.5rem;
      text-align: center;
      padding: 30px;
    }

    .icon-large { font-size: 3.5rem; margin-bottom: 15px; }

    .progress-section {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .progress-title {
      font-size: 1.5rem;
      color: var(--primary-blue);
      font-weight: 700;
    }

    .progress-bar-container {
      height: 20px;
      background: #e0e6ef;
      border-radius: 10px;
      overflow: hidden;
      margin: 25px 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(to right, var(--primary-green), var(--primary-teal));
      border-radius: 10px;
      transition: width 1s ease;
      width: 0%;
    }

    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 25px;
    }

    .module-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 2px solid transparent;
      position: relative;
    }

    .module-card:hover { transform: translateY(-5px); border-color: var(--primary-blue); }

    .module-card.completed {
      border-color: var(--primary-green);
      background: linear-gradient(135deg, #f8fff8 0%, var(--card-bg) 100%);
    }

    .module-card.locked { opacity: 0.7; filter: grayscale(0.3); }

    .module-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: var(--primary-red);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .module-title { font-size: 1.3rem; margin-bottom: 10px; color: var(--text-dark); }

    .module-status {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-top: 15px;
    }

    .status-completed { background: #d5f4e6; color: var(--primary-green); }
    .status-pending { background: #ffeaa7; color: #e17055; }
    .status-locked { background: #e0e6ef; color: var(--text-light); }

    /* Module Screen */
    .module-content {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 35px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      line-height: 1.7;
      font-size: 1.1rem;
    }

    .content-section {
      margin-bottom: 30px;
      padding-bottom: 25px;
      border-bottom: 2px dashed #e8f4fc;
    }

    .content-section h3 {
      color: var(--primary-blue);
      margin-bottom: 15px;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .content-section ul, .content-section ol { padding-left: 25px; margin: 15px 0; }
    .content-section li { margin-bottom: 10px; }

    /* Flip Cards */
    .flip-card {
      background: #f1f8ff;
      border-radius: var(--radius);
      padding: 25px;
      margin: 20px 0;
      cursor: pointer;
      border-left: 5px solid var(--primary-blue);
      transition: var(--transition);
    }

    .flip-card:hover { background: #e3f2fd; transform: translateX(5px); }

    .flip-question {
      font-weight: 600;
      color: var(--primary-blue);
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .flip-answer {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px dashed #b3e0ff;
      color: var(--text-dark);
      display: none;
    }

    .flip-card.active .flip-answer { display: block; animation: fadeIn 0.5s ease; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Quiz Screen */
    .quiz-container {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 35px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .quiz-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 3px solid #e8f4fc;
    }

    .quiz-progress { font-size: 1.1rem; color: var(--text-light); margin-bottom: 10px; }
    .quiz-question { font-size: 1.5rem; color: var(--text-dark); margin-bottom: 30px; line-height: 1.5; }

    .quiz-options { display: grid; gap: 15px; margin-bottom: 30px; }

    .quiz-option {
      background: #f8fafc;
      padding: 20px 25px;
      border-radius: var(--radius);
      border: 2px solid #e0e6ef;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 1.1rem;
    }

    .quiz-option:hover { background: #eef5ff; border-color: var(--primary-blue); }
    .quiz-option.selected { background: #e3f2fd; border-color: var(--primary-blue); color: var(--primary-blue); }

    .option-indicator {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      background: white;
      flex-shrink: 0;
    }

    .quiz-feedback {
      padding: 25px;
      background: #f8f9fa;
      border-radius: var(--radius);
      margin-top: 25px;
      display: none;
      animation: fadeIn 0.5s ease;
      border-left: 5px solid var(--primary-teal);
    }

    .quiz-feedback.show { display: block; }

    .feedback-title {
      font-weight: 700;
      color: var(--primary-teal);
      margin-bottom: 10px;
      font-size: 1.2rem;
    }

    .quiz-navigation {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .quiz-score {
      text-align: center;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-blue);
      margin: 30px 0;
      padding: 20px;
      background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      border-radius: var(--radius);
    }

    /* Certificate Screen */
    .certificate-container {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 40px;
      box-shadow: var(--shadow);
      max-width: 900px;
      margin: 0 auto;
      text-align: center;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 25px;
      margin-top: 40px;
      color: var(--text-light);
      font-size: 0.9rem;
      line-height: 1.6;
      opacity: 0.8;
      width: 100%;
      max-width: 1200px;
      border-top: 1px solid rgba(0,0,0,0.1);
    }

    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
      display: none;
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      top: -10px;
      border-radius: 2px;
    }

    /* ‚úÖ MISSING KEYFRAMES FIX */
    @keyframes fall {
      0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotate(720deg); opacity: 0.95; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header h1 { font-size: 2rem; }
      .header h2 { font-size: 1.1rem; }
      .track-buttons { grid-template-columns: 1fr; }
      .track-btn { height: 150px; font-size: 1.3rem; }
      .icon-large { font-size: 2.5rem; }
      .module-content, .quiz-container, .certificate-container { padding: 25px; }
      .btn { padding: 15px 25px; font-size: 1.1rem; }
      .quiz-question { font-size: 1.3rem; }
    }

    @media (max-width: 480px) {
      body { padding: 10px; }
      .header { padding: 20px 15px; }
    }

    /* Utility */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mt-20 { margin-top: 20px; }
    .mb-20 { margin-bottom: 20px; }
  </style>
</head>

<body>
  <div class="container">
    <!-- Home Screen -->
    <div id="home-screen" class="screen">
      <div class="header">
        <h1>üß¨ STI SmartLearn</h1>
        <h2>Interactive learning on HIV and Syphilis for adults</h2>
      </div>

      <div class="content">
        <div class="track-buttons">
          <button class="btn btn-primary track-btn" onclick="loadTrack('hiv')">
            <span class="icon-large">üß¨</span>
            HIV Learning Track
          </button>
          <button class="btn btn-secondary track-btn" onclick="loadTrack('syphilis')">
            <span class="icon-large">ü¶†</span>
            Syphilis Learning Track
          </button>
        </div>

        <div class="progress-section">
          <div class="progress-header">
            <div class="progress-title">Your Learning Progress</div>
            <div id="overall-progress">0% Complete</div>
          </div>
          <div class="progress-bar-container">
            <div id="global-progress-bar" class="progress-bar"></div>
          </div>
          <div class="text-center mb-20">
            Complete all modules to unlock your certificate
          </div>

          <button id="certificate-btn" class="btn btn-certificate" onclick="openCertificateScreen()" disabled>
            üèÜ Get Certificate
          </button>
        </div>

        <div class="progress-section">
          <div class="progress-title">Quick Module Access</div>
          <div class="modules-grid" id="quick-modules"></div>
        </div>
      </div>
    </div>

    <!-- Track Screen -->
    <div id="track-screen" class="screen hidden">
      <div class="header">
        <h1 id="track-title"></h1>
        <button class="btn btn-back" onclick="loadHome()">‚Üê Back to Home</button>
      </div>

      <div class="content">
        <div class="progress-section">
          <div class="progress-header">
            <div class="progress-title" id="track-modules-title"></div>
            <div id="track-progress">0% Complete</div>
          </div>
          <div class="progress-bar-container">
            <div id="track-progress-bar" class="progress-bar"></div>
          </div>
        </div>

        <div class="modules-grid" id="track-modules"></div>
      </div>
    </div>

    <!-- Module Screen -->
    <div id="module-screen" class="screen hidden">
      <div class="header">
        <h1 id="module-title"></h1>
        <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
          <button class="btn btn-back" onclick="loadTrackScreen()">‚Üê Back to Modules</button>
          <button id="start-quiz-btn" class="btn btn-primary" onclick="startQuiz()">Take Quiz ‚Üí</button>
        </div>
      </div>
      <div class="content">
        <div id="module-content" class="module-content"></div>
      </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen" class="screen hidden">
      <div class="header">
        <h1 id="quiz-title"></h1>
        <button class="btn btn-back" onclick="loadModuleScreen()">‚Üê Back to Module</button>
      </div>

      <div class="content">
        <div class="quiz-container">
          <div class="quiz-header">
            <div class="quiz-progress" id="quiz-progress">Question 1 of 5</div>
            <div class="quiz-question" id="quiz-question"></div>
          </div>

          <div class="quiz-options" id="quiz-options"></div>

          <div class="quiz-feedback" id="quiz-feedback">
            <div class="feedback-title" id="feedback-title"></div>
            <div id="feedback-explanation"></div>
          </div>

          <div class="quiz-navigation">
            <button class="btn btn-back" onclick="loadModuleScreen()">‚Üê Exit Quiz</button>
            <button id="next-question-btn" class="btn btn-primary" onclick="nextQuestion()" disabled>Next Question ‚Üí</button>
            <button id="submit-quiz-btn" class="btn btn-secondary hidden" onclick="submitQuiz()" disabled>Submit Quiz</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="screen hidden">
      <div class="header">
        <h1>Quiz Results</h1>
        <button class="btn btn-back" onclick="loadTrackScreen()">‚Üê Back to Modules</button>
      </div>

      <div class="content">
        <div class="quiz-container">
          <div class="quiz-score">
            Score: <span id="final-score">0</span>%
          </div>

          <div class="content-section">
            <h3>üìä Performance Summary</h3>
            <p id="performance-text"></p>
            <div class="progress-bar-container mt-20">
              <div id="results-progress-bar" class="progress-bar"></div>
            </div>
          </div>

          <div class="content-section">
            <h3>üéØ Next Steps</h3>
            <p id="next-steps-text"></p>
          </div>

          <div class="quiz-navigation">
            <button class="btn btn-secondary" onclick="retakeQuiz()">Retake Quiz</button>
            <button class="btn btn-primary" onclick="continueLearning()">Continue Learning ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Certificate Screen (kept minimal here; your original block can stay) -->
    <div id="certificate-screen" class="screen hidden">
      <div class="header">
        <h1>Certificate of Completion</h1>
        <button class="btn btn-back" onclick="loadHome()">‚Üê Back to Home</button>
      </div>

      <div class="content">
        <div class="certificate-container">
          <p style="margin-bottom:12px;">
            Your certificate feature is still in your original code section.
          </p>
          <button class="btn btn-back" onclick="loadHome()">Back</button>
        </div>
      </div>
    </div>

    <!-- Confetti -->
    <div class="confetti-container" id="confetti-container"></div>

    <!-- Footer -->
    <div class="footer">
      Conceptualized by Hanover HIV/STI/TB Treatment and Prevention Team in our Parish Meeting 2026.
      Designed by Glenroy Griffiths 8765029756.
    </div>
  </div>

  <script>
    // ============================================================================
    // APPLICATION STATE & DATA (kept)
    // ============================================================================
    const appState = {
      currentTrack: null,
      currentModule: null,
      currentQuestion: 0,
      userAnswers: [],
      completedModules: { hiv: [false, false, false, false], syphilis: [false, false, false, false] },
      quizScores: { hiv: [0, 0, 0, 0], syphilis: [0, 0, 0, 0] },
      userName: '',
      certificateUnlocked: false,
      certificateId: '',
      completionDate: ''
    };

    // ‚úÖ IMPORTANT:
    // I‚Äôm keeping your learningContent as-is so you can paste back in your full content.
    // Paste your full "learningContent" object here exactly as it was.
    const learningContent = window.learningContent || {
      hiv: [
        {
          title: "Module 1: What is HIV?",
          content: `<div class="content-section"><h3>üß¨ HIV Definition</h3><p>Content here‚Ä¶ (paste your full content)</p></div>`,
          quiz: [
            { question: "Demo Q1?", options: ["A","B","C","D"], correct: 0, explanation: "Explanation" },
            { question: "Demo Q2?", options: ["A","B"], correct: 0, explanation: "Explanation" }
          ]
        },
        { title:"Module 2", content:"<div class='content-section'><h3>...</h3></div>", quiz:[{question:"?",options:["A","B"],correct:0,explanation:""}] },
        { title:"Module 3", content:"<div class='content-section'><h3>...</h3></div>", quiz:[{question:"?",options:["A","B"],correct:0,explanation:""}] },
        { title:"Module 4", content:"<div class='content-section'><h3>...</h3></div>", quiz:[{question:"?",options:["A","B"],correct:0,explanation:""}] }
      ],
      syphilis: [
        { title:"Module 1", content:"<div class='content-section'><h3>...</h3></div>", quiz:[{question:"?",options:["A","B"],correct:0,explanation:""}] },
        { title:"Module 2", content:"<div class='content-section'><h3>...</h3></div>", quiz:[{question:"?",options:["A","B"],correct:0,explanation:""}] },
        { title:"Module 3", content:"<div class='content-section'><h3>...</h3></div>", quiz:[{question:"?",options:["A","B"],correct:0,explanation:""}] },
        { title:"Module 4", content:"<div class='content-section'><h3>...</h3></div>", quiz:[{question:"?",options:["A","B"],correct:0,explanation:""}] }
      ]
    };

    // ============================================================================
    // SCREEN NAV
    // ============================================================================
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
      document.getElementById(screenId).classList.remove('hidden');
      window.scrollTo(0, 0);
    }

    // ============================================================================
    // HOME / TRACK / MODULE
    // ============================================================================
    function loadHome() {
      showScreen('home-screen');
      updateProgressDisplay();
      loadQuickModules();
    }

    function loadTrack(track) {
      appState.currentTrack = track;
      const trackTitle = track === 'hiv' ? 'üß¨ HIV Learning Track' : 'ü¶† Syphilis Learning Track';
      document.getElementById('track-title').textContent = trackTitle;
      document.getElementById('track-modules-title').textContent = `${trackTitle} Modules`;

      updateTrackProgress();
      loadTrackModules();
      showScreen('track-screen');
    }

    function loadTrackScreen() {
      if (appState.currentTrack) loadTrack(appState.currentTrack);
      else loadHome();
    }

    function loadModule(moduleIndex) {
      const track = appState.currentTrack;
      const moduleData = learningContent[track][moduleIndex];
      appState.currentModule = moduleIndex;

      document.getElementById('module-title').textContent = moduleData.title;
      document.getElementById('module-content').innerHTML = moduleData.content;

      initFlipCards();
      showScreen('module-screen');
    }

    function loadModuleScreen() {
      if (appState.currentTrack !== null && appState.currentModule !== null) loadModule(appState.currentModule);
      else loadTrackScreen();
    }

    function initFlipCards() {
      document.querySelectorAll('.flip-card').forEach(card => {
        card.addEventListener('click', () => card.classList.toggle('active'));
      });
    }

    // ============================================================================
    // QUIZ ENGINE (FIXED)
    // ============================================================================
    function startQuiz() {
      appState.currentQuestion = 0;
      appState.userAnswers = [];
      loadQuestion();
      showScreen('quiz-screen');
    }

    function loadQuestion() {
      const track = appState.currentTrack;
      const moduleIndex = appState.currentModule;
      const quizData = learningContent[track][moduleIndex].quiz;
      const q = quizData[appState.currentQuestion];

      document.getElementById('quiz-title').textContent = learningContent[track][moduleIndex].title + ' Quiz';
      document.getElementById('quiz-progress').textContent = `Question ${appState.currentQuestion + 1} of ${quizData.length}`;
      document.getElementById('quiz-question').textContent = q.question;

      const optionsContainer = document.getElementById('quiz-options');
      optionsContainer.innerHTML = '';

      q.options.forEach((opt, idx) => {
        const el = document.createElement('div');
        el.className = 'quiz-option';
        el.innerHTML = `
          <div class="option-indicator">${String.fromCharCode(65 + idx)}</div>
          <div>${opt}</div>
        `;
        el.onclick = () => selectAnswer(idx);
        optionsContainer.appendChild(el);
      });

      // reset feedback
      document.getElementById('quiz-feedback').classList.remove('show');

      // ‚úÖ FIX: disable nav until answer selected
      const nextBtn = document.getElementById('next-question-btn');
      const submitBtn = document.getElementById('submit-quiz-btn');

      nextBtn.disabled = true;
      submitBtn.disabled = true;

      // show correct nav buttons for last question
      const isLast = appState.currentQuestion === quizData.length - 1;
      nextBtn.classList.toggle('hidden', isLast);
      submitBtn.classList.toggle('hidden', !isLast);
    }

    function selectAnswer(answerIndex) {
      const options = document.querySelectorAll('.quiz-option');
      options.forEach(o => o.classList.remove('selected'));
      options[answerIndex].classList.add('selected');

      const track = appState.currentTrack;
      const moduleIndex = appState.currentModule;
      const quizData = learningContent[track][moduleIndex].quiz;
      const q = quizData[appState.currentQuestion];

      appState.userAnswers[appState.currentQuestion] = answerIndex;

      // feedback
      const feedback = document.getElementById('quiz-feedback');
      const title = document.getElementById('feedback-title');
      const expl = document.getElementById('feedback-explanation');

      const correct = (answerIndex === q.correct);
      title.textContent = correct ? '‚úÖ Correct!' : '‚ùå Incorrect';
      title.style.color = correct ? 'var(--primary-green)' : 'var(--primary-red)';
      expl.textContent = q.explanation;
      feedback.classList.add('show');

      // ‚úÖ FIX: enable correct nav button after selection
      const isLast = appState.currentQuestion === quizData.length - 1;
      document.getElementById('next-question-btn').disabled = isLast ? true : false;
      document.getElementById('submit-quiz-btn').disabled = isLast ? false : true;
    }

    function nextQuestion() {
      const track = appState.currentTrack;
      const moduleIndex = appState.currentModule;
      const quizData = learningContent[track][moduleIndex].quiz;

      if (appState.userAnswers[appState.currentQuestion] === undefined) return;

      if (appState.currentQuestion < quizData.length - 1) {
        appState.currentQuestion++;
        loadQuestion();
      }
    }

    function submitQuiz() {
      if (appState.userAnswers[appState.currentQuestion] === undefined) return;

      const track = appState.currentTrack;
      const moduleIndex = appState.currentModule;
      const quizData = learningContent[track][moduleIndex].quiz;

      let correct = 0;
      quizData.forEach((q, i) => { if (appState.userAnswers[i] === q.correct) correct++; });
      const score = Math.round((correct / quizData.length) * 100);

      appState.quizScores[track][moduleIndex] = score;
      if (score >= 70) appState.completedModules[track][moduleIndex] = true;

      saveState();
      showQuizResults(score, correct, quizData.length);
    }

    function showQuizResults(score, correct, total) {
      document.getElementById('final-score').textContent = score;
      document.getElementById('results-progress-bar').style.width = score + '%';

      const perf = document.getElementById('performance-text');
      const next = document.getElementById('next-steps-text');

      if (score >= 70) {
        perf.textContent = `Congratulations! You passed with ${correct} out of ${total} correct (${score}%). This module is now completed.`;
        next.textContent = `Continue to the next module or return to the module list.`;
      } else {
        perf.textContent = `You scored ${correct} out of ${total} correct (${score}%). You need 70% or higher to pass.`;
        next.textContent = `Review the module content and retake the quiz.`;
      }

      updateProgressDisplay();
      showScreen('results-screen');
    }

    function retakeQuiz() { startQuiz(); }
    function continueLearning() { loadTrackScreen(); }

    // ============================================================================
    // PROGRESS / MODULE CARDS
    // ============================================================================
    function updateProgressDisplay() {
      const total = 8;
      let completed = 0;
      for (let i = 0; i < 4; i++) {
        if (appState.completedModules.hiv[i]) completed++;
        if (appState.completedModules.syphilis[i]) completed++;
      }
      const pct = Math.round((completed / total) * 100);
      document.getElementById('overall-progress').textContent = `${pct}% Complete`;
      document.getElementById('global-progress-bar').style.width = `${pct}%`;

      const certBtn = document.getElementById('certificate-btn');
      if (completed === total) {
        certBtn.disabled = false;
        certBtn.classList.add('unlocked');
      } else {
        certBtn.disabled = true;
        certBtn.classList.remove('unlocked');
      }
    }

    function updateTrackProgress() {
      const track = appState.currentTrack;
      const total = 4;
      const completed = appState.completedModules[track].filter(Boolean).length;
      const pct = Math.round((completed / total) * 100);
      document.getElementById('track-progress').textContent = `${pct}% Complete`;
      document.getElementById('track-progress-bar').style.width = `${pct}%`;
    }

    function createModuleCard(track, index, title, isCompleted, isLocked = false) {
      const card = document.createElement('div');
      card.className = `module-card ${isCompleted ? 'completed' : ''} ${isLocked ? 'locked' : ''}`;
      const trackIcon = track === 'hiv' ? 'üß¨' : 'ü¶†';

      const statusText = isCompleted ? 'Completed' : (isLocked ? 'Locked' : 'Available');
      const statusClass = isCompleted ? 'status-completed' : (isLocked ? 'status-locked' : 'status-pending');

      card.innerHTML = `
        <div class="module-badge">${trackIcon}</div>
        <h3 class="module-title">${title}</h3>
        <p>${track === 'hiv' ? 'HIV Education' : 'Syphilis Education'}</p>
        <div class="module-status ${statusClass}">${statusText}</div>
      `;

      if (!isLocked) {
        card.style.cursor = 'pointer';
        card.onclick = () => { appState.currentTrack = track; loadModule(index); };
      } else {
        card.style.cursor = 'not-allowed';
        card.title = 'Complete previous module first';
      }

      return card;
    }

    function loadQuickModules() {
      const c = document.getElementById('quick-modules');
      c.innerHTML = '';
      for (let i = 0; i < 4; i++) c.appendChild(createModuleCard('hiv', i, learningContent.hiv[i].title, appState.completedModules.hiv[i], false));
      for (let i = 0; i < 4; i++) c.appendChild(createModuleCard('syphilis', i, learningContent.syphilis[i].title, appState.completedModules.syphilis[i], false));
    }

    function loadTrackModules() {
      const c = document.getElementById('track-modules');
      c.innerHTML = '';
      const track = appState.currentTrack;

      learningContent[track].forEach((m, idx) => {
        const isCompleted = appState.completedModules[track][idx];
        const isLocked = idx > 0 && !appState.completedModules[track][idx - 1];
        c.appendChild(createModuleCard(track, idx, m.title, isCompleted, isLocked));
      });
    }

    // ============================================================================
    // CERTIFICATE PLACEHOLDER (your full certificate system can be pasted back)
    // ============================================================================
    function openCertificateScreen() {
      alert("Your certificate screen is in your original code. Paste it back into this fixed version if needed.");
      showScreen('certificate-screen');
    }

    // ============================================================================
    // STORAGE
    // ============================================================================
    function saveState() { localStorage.setItem('stiSmartLearnState', JSON.stringify(appState)); }

    function loadState() {
      const saved = localStorage.getItem('stiSmartLearnState');
      if (!saved) return;
      try {
        Object.assign(appState, JSON.parse(saved));
      } catch (_) {}
    }

    // ============================================================================
    // INIT
    // ============================================================================
    function init() {
      loadState();
      loadHome();
    }
    window.onload = init;
  </script>
</body>
</html>
